<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>특정 코스 상세보기
    </title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> <!-- axios 추가 -->
    <script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=qxgq0uh1ml"></script>
</head>

<body>

    <div class="container">
        <div class="header">
            <div class="navbar">
                <ul class="navbar-ul">
                    <li>
                        <img class="logo-img" src="./img/app-logo.png">
                    </li>
                    <li>
                        <a href="index.html">
                            <h3>어디카세</h3>
                        </a>
                    </li>
                    <li>
                        <a href="course.html">
                            <h3>코스 둘러보기</h3>
                        </a>
                    </li>
                    <li class="search">
                        <input type="search" placeholder="코스를 검색해보세요" onfocus="this.placeholder=''">
                    </li>
                </ul>
            </div>
            <div class="img-banner">
                <div class="store-img"></div>
                <div class="store-img"></div>
                <div class="store-img"></div>
            </div>
        </div>
        <div class="course-detail">
            <div class="user-info">
                <div class="profile-img"></div>
                <div class="user-nickname"></div>
            </div>
            <div class="course-info">
                <div class="course-name"></div>
                <div class="course-categories"></div>
            </div>
            <div class="map-info">
                <div class="map-info-text">
                    <h1>코스 정보</h1>
                </div>

                <div id="map" style="width:100%; height:700px;"></div>
            </div>
            <div class="more">
                <div class="section-wrap">
                    <div class="section-text">
                        <p class="text">코스 내용을 상세하게 보고싶다면 <br>어디카세 앱을 다운받아 보세요!</p>
                    </div>
                </div>
                <div class="section-wrap">
                    <input class="move-button" type="button" onclick="location" href='https://www.naver.com/'
                        value=" 앱 다운하러 가기">
                </div>
            </div>
            <div class="footer">
                <ul class="top-keywords-list">
                    <li>
                        <a href="#">이용약관</a>
                    </li>
                    <li>
                        <a href="#">개인정보처리방침</a>
                    </li>
                    <li>
                        <a href="#">위치기반서비스 이용약관</a>
                    </li>
                </ul>
            </div>
        </div>


        <script>
            /* Naver Map 호출*/

            // const locations = [
            //     { place: "건대입구역", lat: 37.539922, lng: 127.070609 },
            //     { place: "어린이대공원역", lat: 37.547263, lng: 127.074181 },
            //     { place: "테스트용", lat: 37.547263, lng: 127.078101 },
            // ];

            // const map = document.getElementById('.map');

            function drawMap(locations) {

                var map = new naver.maps.Map('map', {
                    center: new naver.maps.LatLng(locations[0].lat, locations[0].lng), // 배열의 첫 번째 위치를 중심으로 하는 지도
                    zoom: 15
                });

                for (var i = 0; i < locations.length; i++) {
                    var marker = new naver.maps.Marker({
                        title: locations[i].place,
                        position: new naver.maps.LatLng(locations[i].lat, locations[i].lng),
                        map: map
                    });
                }
                var polyline = new naver.maps.Polyline({
                    path: locations,      //선 위치 변수배열
                    strokeColor: '#FF0000', //선 색 빨강 #빨강,초록,파랑
                    strokeOpacity: 0.8, //선 투명도 0 ~ 1
                    strokeWeight: 6,   //선 두께
                    map: map           //오버레이할 지도
                });

            }

            function getLocations(courseData) {
                const locations = courseData.courseItems.map((store) => {
                    // 새로운 객체를 만들어 필요한 속성만 포함시킴
                    return {
                        place: store.name,
                        lat: store.lat,
                        lng: store.lng,
                    };
                });
                console.log('locations', locations);

                drawMap(locations);
            }

            function loadImgBanner(courseData_data) {
                // 첫 번째 store-img 요소를 선택하고 내용을 변경
                var firstStoreImg = document.querySelector('.img-banner .store-img:first-child');
                firstStoreImg.innerHTML += `<img src = ${courseData_data.courseItems[0].imageUrl} >`;

                // 두 번째 store-img 요소를 선택하고 내용을 변경
                var secondStoreImg = document.querySelector('.img-banner .store-img:nth-child(2)');
                secondStoreImg.innerHTML += `<img src = ${courseData_data.courseItems[1].imageUrl} >`;

                // 세 번째 store-img 요소를 선택하고 내용을 변경
                var thirdStoreImg = document.querySelector('.img-banner .store-img:nth-child(3)');
                thirdStoreImg.innerHTML += `<img src = ${courseData_data.courseItems[2].imageUrl} >`;
                // const imageUrl = courseData_data.courseItems[0].imageUrl; // 이후 배열 처리

            }

            function loadCourseContent(courseData_data) {


                const profileImgContainer = document.querySelector('.profile-img');
                const userNicknameContainer = document.querySelector('.user-nickname');
                const courseNameContainer = document.querySelector('.course-name');
                const courseCatergoriesContainer = document.querySelector('.course-categories');

                //const profileImg = courseData_data.memberProfileImage; // null
                const profileImg = courseData_data.courseItems[0].imageUrl; // 임의
                const userNickname = courseData_data.nickname;
                const courseName = courseData_data.courseName;
                const cartegories = getCategories(courseData_data);

                //console.log('course 정보', profileImg, userNickname, courseName, cartegories);

                profileImgContainer.innerHTML = `<img class="card-profile-img" src = ${profileImg}>`;
                userNicknameContainer.innerText = userNickname;
                courseNameContainer.innerHTML = `<h2 class="card-title"> ${courseName}</h2 >`;
                courseCatergoriesContainer.innerText = cartegories;

            }





            // content 배열에서 모든 courseItems의 category 속성을 추출하여 배열 만들기
            function getCategories(courseData_data) {
                const categories = courseData_data.courseItems.map((store) => {
                    const category = store.category.split(',')[0].trim();
                    //console.log('category', category);
                    return category;
                });

                console.log('categories', categories);

                return categories; // 매장 정보 담긴 categories 반환
            }



            // 특정 코스 조회
            // const data = ;
            // function init() {


            //     const url = window.location.pathname;
            //     const container = document.querySelector('.course-info'); // courseData는 Array // courseData === response.data.data.content
            //     container.innerHTML += ` < div >
            //                 <h4>${url}</h4>
            //             </div>`;
            // }



            // init();





            function init() {
                axios.get('https://eodikase.com/v1/courses/course/48')
                    .then(function (response) {
                        // 성공시 경우 실행
                        console.log('GET Response Data:', response.data.data);
                        getLocations(response.data.data);
                        loadImgBanner(response.data.data);
                        loadCourseContent(response.data.data); // 성공시 피드 화면 만드는 함수 실행

                    })
                    .catch(function (error) {
                        // 에러인 경우 실행
                        console.log('error');
                    });
            }


            init();

        </script>

</body>

</html>